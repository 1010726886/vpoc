<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>D3 Page Template</title>
    <script type="text/javascript" src="../scripts/common/d3.v5.min.js"></script>
    <style>
    </style>
</head>
<body>
<p>Click on this text to update the chart with new data values (once).</p>

<script type="text/javascript">
    var dataset = [5, 10, 13, 19, 21, 25, 22, 18, 15, 13];
    var w = 600;
    var h = 600;
    var padding = 100;
    //Create SVG element
    var svg = d3.select("body")
        .append("svg")
        .attr("width", 800)
        .attr("height", 800)
        .append("g")
        .attr("transform", `translate(${padding}, ${padding})`);

    var xScale = d3.scaleBand()
        .domain(d3.range(dataset.length))
        .range([0, w])
        .round(true)  // <-- Enable rounding
        // .rangeRound([0, w])  // <-- Also enables rounding
        .paddingInner(0.05);
    // var xAxis = d3.axisBottom()
    //     .scale(xScale);
    // .ticks(5);  //Set rough # of ticks
    // .tickValues([0, 100, 250, 600]);
    // .tickFormat(formatAsPercentage);
    // svg.append("g")
    //     .attr("class", "axis")
    //     .attr("transform", "translate(0," + h + ")")
    //     .call(xAxis);

    var yScale = d3.scaleLinear()
        .domain([0, d3.max(dataset)])
        .range([0, h])
        .nice();
    //Define Y axis
    // var yAxis = d3.axisLeft()
    //     .scale(yScale);
    // .ticks(5);
    // svg.append("g")
    //     .attr("class", "axis")
    //     .attr("transform", "translate(" + 0 + ",0)")
    //     .call(yAxis);

    //Create bars
    svg.selectAll("rect")
        .data(dataset)
        .enter()
        .append("rect")
        .attr("x", function (d, i) {
            return xScale(i);  // <-- Set x values
        })
        .attr("y", d => h - yScale(d))
        .attr("width", xScale.bandwidth())
        .attr("height", d => yScale(d))
        .attr("fill", function (d) {
            return "rgb(0, 0, " + Math.round(d * 10) + ")";
        });

    svg.selectAll("text")
        .data(dataset)
        .enter()
        .append('text')
        .attr("x", function (d, i) {
            return xScale(i) + xScale.bandwidth() / 2;
        })
        .attr("y", function (d) {
            return h - yScale(d) - 10;
        })
        .attr("text-anchor", "middle")
        .text(d => d);

    d3.select("p")
        .on("click", function () {
            // Changing the Data
            //New values for dataset
            var numValues = dataset.length;               //Count original length of dataset
            let maxValue = 50;
            dataset = [];                                       //Initialize empty array
            for (var i = 0; i < numValues; i++) {               //Loop numValues times
                var newNumber = Math.floor(Math.random() * maxValue); //New random integer (0-24)
                dataset.push(newNumber);                        //Add new number to array
            }
            yScale.domain([0, d3.max(dataset)]);
            // rebind the new values
            // Updating the Visuals
            svg.selectAll("rect")
                .data(dataset)
                // Make sure to always set an initial value before attempting to transition to a new value.
                .transition()    // <-- This is new! Everything else here is unchanged.
                .ease(d3.easeBounceOut) // The default easing is d3.easeCubicInOut
                .delay(function (d, i) {
                    return i / dataset.length * 1000;   // <-- Where the magic happens
                })
                .duration(1000)
                .attr("y", function (d) {
                    return h - yScale(d);
                })
                .attr("height", function (d) {
                    return yScale(d);
                })
                .attr("fill", function (d) {   // <-- Down here!
                    return "rgb(0, 0, " + Math.round(d * 10) + ")";
                });

            svg.selectAll("text")
                .data(dataset)
                .transition()
                .delay(function (d, i) {
                    return i / dataset.length * 1000;   // <-- Where the magic happens
                })
                .duration(1000)
                .attr("x", function (d, i) {
                    return xScale(i) + xScale.bandwidth() / 2;
                })
                .attr("y", function (d) {
                    return h - yScale(d) - 10;
                })
                .attr("text-anchor", "middle")
                .text(d => d);

//             //Update x-axis
//             svg.select(".x.axis")
//                 .transition()
//                 .duration(1000)
//                 .call(xAxis);
//
// //Update y-axis
//             svg.select(".y.axis")
//                 .transition()
//                 .duration(1000)
//                 .call(yAxis);
        });
</script>
</body>
</html>